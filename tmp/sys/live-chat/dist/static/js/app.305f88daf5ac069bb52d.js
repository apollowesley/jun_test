webpackJsonp([1],[,,,,,,,,,,function(e,t,n){"use strict";function s(e){e.client=new a.a({host:"47.94.2.0",port:80}),e.client.connect()||alert("连接失败")}var i=n(33),r=n(0),o=n(44),a=n(117),u=n(32);i.a.use(r.a);var c=new r.a.Store({state:{client:null,users:[],me:null,sessions:[],currentSession:null,filterKey:"",barrageContainer:null},getters:{client:function(e){return e.client},users:function(e){return e.users},onlineUsers:function(e){var t=e.users,n=e.myLoginName;return t.filter(function(e){return e.loginName!==n})},me:function(e){return e.me},myLoginName:function(e){return e.myLoginName},sessions:function(e){var t=e.sessions,n=e.filterKey;return t&&t.filter(function(e){return!n||e.loginName.toUpperCase().includes(n.toUpperCase())})},currentSession:function(e){return e.currentSession}},mutations:{initSessions:function(e,t){var n={},s=e.users;t.forEach(function(e){e.messages.forEach(function(t){t.read||(n[e.loginName]||(n[e.loginName]=0),n[e.loginName]++)})}),s.forEach(function(e){var t=n[e.loginName],i=s.indexOf(e);e.notReadMsgCount=t,s.splice(i,1,e)}),e.sessions=t},setCurrentSession:function(e,t){t.messages||(t.messages=[]);var s=n.i(u.a)(t.loginName);s?e.currentSession=s:(s=t,e.currentSession=t,e.sessions.push(t)),s.notRead=0;for(var i=0;i<s.messages.length;i++)if(!s.messages[i].read&&e.me.loginName===s.messages[i].to){e.client.read(s.messages[i]);break}var r=n.i(u.b)(t.loginName);if(r){var o=e.users.indexOf(r);r.notReadMsgCount=0,e.users.splice(o,1,r)}},initUsers:function(e,t){e.me=t,e.users=t.onlineUsers},refreshUser:function(e,t){var s=void 0;if(s=n.i(u.b)(t.loginName))return n.i(u.c)(s,t),e.users[e.users.indexOf(s)]=t;e.users.push(t)},setFilterKey:function(e,t){return e.filterKey=t},logout:function(e){return e.me=null},appendBarrage:function(e,t){var s=void 0,i=document.createElement("div");i.classList.add("barrage"),i.innerHTML=t.content,s=t.from===e.me.loginName?"myBarrage":"otherBarrage",i.classList.add(s),i.style.left=e.barrageContainer.offsetWidth+"px",e.barrageContainer.appendChild(i),i.style.top=(1*Math.random()+0)*(e.barrageContainer.offsetHeight-i.offsetHeight)+"px",n.i(o.a)(i,"left",e.barrageContainer.offsetWidth+i.offsetWidth,3,function(){i.parentNode.removeChild(i)})}},actions:{register:function(e,t){var n=e.state;s(n),n.client.register(t)},login:function(e,t){var n=e.state;s(n),n.client.login(t)},sendMsg:function(e,t){var s=e.state,i=n.i(u.d)(),r={id:i,from:s.me.loginName,to:s.currentSession.loginName,content:t,self:!0,read:!1,date:new Date},o={};n.i(u.c)(o,s.currentSession),o.messages.push(r),s.currentSession=o,s.client.sendMsg({id:i,from:s.me.loginName,to:s.currentSession.loginName,content:t})},sendBarrage:function(e,t){var n=e.state;n.client.sendBarrage({from:n.me.loginName,content:t})}}});t.a=c},,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";function s(e){for(var t=d.a.getters.sessions,n=0;n<t.length;n++)if(t[n].loginName===e)return t[n]}function i(e){for(var t=d.a.getters.users,n=0;n<t.length;n++)if(t[n].loginName===e)return t[n]}function r(e,t){if(!e||!t)return console.error("target and source must not be null");for(var n in t)e[n]=t[n]}function o(e,t){if(!t){var n=window.localStorage.getItem(e);return n?JSON.parse(n):null}"object"===(void 0===t?"undefined":f()(t))&&(t=c()(t)),window.localStorage.setItem(e,t)}function a(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})}n.d(t,"a",function(){return s}),n.d(t,"b",function(){return i}),n.d(t,"c",function(){return r}),n.d(t,"e",function(){return o}),n.d(t,"d",function(){return a});var u=n(104),c=n.n(u),l=n(108),f=n.n(l),d=n(10)},,,,,,,,,,,,function(e,t,n){"use strict";function s(e,t,n,s){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:function(){console.log("callback called")};a="function"==typeof s?s:a;var u=[];return i=null,r=null,u.next=function(t,n,s){return this.push({fn:o(e,t,n,s),dir:t,last_x:n}),u},function(){function i(t,n){function s(){"left"===n||"right"===n?e.offsetLeft!==r()?requestAnimationFrame(s):(u[0]&&(o=u.shift()),o||a(),o&&i(o.fn,o.dir)):"top"!==n&&"bottom"!==n||(e.offsetTop!==r()?requestAnimationFrame(s):(u[0]&&(o=u.shift()),o||a(),o&&i(o.fn,o.dir)))}var r=t,o=void 0;requestAnimationFrame(s)}return i(o(e,t,n,s),t),u}()}var i=null,r=null,o=function(){return function(e,t,n,s){s="number"==typeof s?s:5;var o=void 0;return"left"===t&&(o=i=null!==i?i-n:e.offsetLeft-n),"right"===t&&(o=i=null!==i?i+n:e.offsetLeft+n),"top"===t&&(o=r=null!==r?r-n:e.offsetTop-n),"bottom"===t&&(o=r=null!==r?r+n:e.offsetTop+n),function(){return"left"===t?e.offsetLeft>o?e.style.left=e.offsetLeft-s+"px":e.style.left=o+"px":"right"===t?e.offsetLeft<o?e.style.left=e.offsetLeft+s+"px":e.style.left=o+"px":"top"===t?e.offsetTop>o?e.style.top=e.offsetTop-s+"px":e.style.top=o+"px":"bottom"===t&&(e.offsetTop<o?e.style.top=e.offsetTop+s+"px":e.style.top=o+"px"),o}}}();t.a=s},function(e,t,n){function s(e){n(70)}var i=n(1)(n(109),n(62),s,"data-v-b822579a",null);e.exports=i.exports},function(e,t){},function(e,t){},function(e,t,n){function s(e){n(65)}var i=n(1)(n(110),n(57),s,"data-v-59b0957b",null);e.exports=i.exports},function(e,t,n){function s(e){n(68)}var i=n(1)(n(111),n(60),s,null,null);e.exports=i.exports},function(e,t,n){function s(e){n(69)}var i=n(1)(n(112),n(61),s,"data-v-ab3957ee",null);e.exports=i.exports},function(e,t,n){function s(e){n(66)}var i=n(1)(n(113),n(58),s,"data-v-5ca4d274",null);e.exports=i.exports},function(e,t,n){function s(e){n(63)}var i=n(1)(n(114),n(55),s,"data-v-081a726c",null);e.exports=i.exports},function(e,t,n){function s(e){n(64)}var i=n(1)(n(115),n(56),s,"data-v-0e640443",null);e.exports=i.exports},function(e,t,n){function s(e){n(67)}var i=n(1)(n(116),n(59),s,"data-v-5d03e1c0",null);e.exports=i.exports},function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{directives:[{name:"scroll-bottom",rawName:"v-scroll-bottom"}],staticClass:"message"},[e.currentSession?n("ul",e._l(e.currentSession.messages,function(t){return n("li",[n("p",{staticClass:"time"},[n("span",[e._v(e._s(e._f("time")(t.date)))])]),e._v(" "),n("div",{staticClass:"main",class:{self:t.self}},[n("img",{staticClass:"avatar",attrs:{width:"30",height:"30",src:t.self?e.me.img:e.currentSession.img}}),e._v(" "),n("div",{staticClass:"text"},[e._v(e._s(t.content))]),e._v(" "),t.self?n("div",{staticClass:"read-text"},[e._v(e._s(e._f("readFilter")(t.read))+" ")]):e._e()])])})):e._e()])},staticRenderFns:[]}},function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"text"},[n("textarea",{directives:[{name:"model",rawName:"v-model",value:e.content,expression:"content"}],attrs:{disabled:!e.currentSession,placeholder:"按 Enter 发送"},domProps:{value:e.content},on:{keyup:e.onKeyup,input:function(t){t.target.composing||(e.content=t.target.value)}}})])},staticRenderFns:[]}},function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"card"},[n("header",[n("img",{staticClass:"avatar",attrs:{width:"40",height:"40",alt:e.me.name,src:e.me.img}}),e._v(" "),n("p",{staticClass:"name"},[e._v(e._s(e.me.loginName))])]),e._v(" "),n("footer",[n("input",{staticClass:"search",attrs:{type:"text",placeholder:"search user..."},on:{keyup:e.onKeyup}})])])},staticRenderFns:[]}},function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"loginPanel"}},[n("div",{attrs:{id:"loginForm"}},[n("div",{directives:[{name:"show",rawName:"v-show",value:e.showLoginForm,expression:"showLoginForm"}],staticClass:"login"},[n("p",[n("span",{staticClass:"soul-label"},[e._v("\n        账号:\n        ")]),e._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:e.user.loginName,expression:"user.loginName"}],staticClass:"soul-input",attrs:{type:"text"},domProps:{value:e.user.loginName},on:{input:function(t){t.target.composing||(e.user.loginName=t.target.value)}}})]),e._v(" "),n("p",[n("span",{staticClass:"soul-label"},[e._v("\n         密码:\n        ")]),e._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:e.user.password,expression:"user.password"}],staticClass:"soul-input",attrs:{type:"text"},domProps:{value:e.user.password},on:{input:function(t){t.target.composing||(e.user.password=t.target.value)}}})]),e._v(" "),n("div",{staticClass:"loginButtonPanel"},[n("a",{staticClass:"toggle",on:{click:e.toggleLogin}},[e._v("还没注册？")]),e._v(" "),n("button",{staticClass:"soul-button",on:{click:e.denglu}},[e._v("登录")])])]),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:!e.showLoginForm,expression:"!showLoginForm"}],staticClass:"register"},[n("p",[n("span",{staticClass:"soul-label"},[e._v("\n        账号:\n        ")]),e._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:e.user.loginName,expression:"user.loginName"}],staticClass:"soul-input",attrs:{type:"text"},domProps:{value:e.user.loginName},on:{input:function(t){t.target.composing||(e.user.loginName=t.target.value)}}})]),e._v(" "),n("p",[n("span",{staticClass:"soul-label"},[e._v("\n         密码:\n        ")]),e._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:e.user.password,expression:"user.password"}],staticClass:"soul-input",attrs:{type:"text"},domProps:{value:e.user.password},on:{input:function(t){t.target.composing||(e.user.password=t.target.value)}}})]),e._v(" "),n("p",[n("span",{staticClass:"soul-label"},[e._v("\n         确认密码:\n        ")]),e._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:e.user.confirmPassword,expression:"user.confirmPassword"}],staticClass:"soul-input",attrs:{type:"text"},domProps:{value:e.user.confirmPassword},on:{input:function(t){t.target.composing||(e.user.confirmPassword=t.target.value)}}})]),e._v(" "),n("p",[n("span",{staticClass:"soul-label"},[e._v("\n         注册秘钥:\n        ")]),e._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:e.user.registerCode,expression:"user.registerCode"}],staticClass:"soul-input",attrs:{type:"text"},domProps:{value:e.user.registerCode},on:{input:function(t){t.target.composing||(e.user.registerCode=t.target.value)}}})]),e._v(" "),n("div",{staticClass:"loginButtonPanel"},[n("a",{staticClass:"toggle",on:{click:e.toggleLogin}},[e._v("已经注册？")]),e._v(" "),n("button",{staticClass:"soul-button",on:{click:e.zhuce}},[e._v("注册")])])])])])},staticRenderFns:[]}},function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticStyle:{width:"150px"}},[e._v("\n  当前登录用户\n  "),n("ul",e._l(e.onlineUsers,function(t){return n("li",[n("img",{staticStyle:{width:"20px",height:"20px",display:"inline-block","vertical-align":"middle"},attrs:{src:t.img}}),e._v(" "),t.notReadMsgCount?n("span",{staticStyle:{float:"right","background-color":"yellow"}},[e._v(e._s(t.notReadMsgCount)+"未读")]):e._e(),e._v(" "),n("a",{attrs:{href:"#"},on:{click:function(n){e.setCurrentSession(t)}}},[e._v(e._s(e._f("truncateStr")(t.loginName)))])])}))])},staticRenderFns:[]}},function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"barrageSendPanel"},[n("span",{staticClass:"soul-label",staticStyle:{color:"red"}},[e._v(e._s(e.error))]),e._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:e.msg,expression:"msg"}],staticClass:"soul-input",staticStyle:{height:"50%"},attrs:{type:"text"},domProps:{value:e.msg},on:{input:function(t){t.target.composing||(e.msg=t.target.value)}}}),e._v(" "),n("button",{staticClass:"soul-button",on:{click:e.sendBarrage}},[e._v("发送弹幕")])])},staticRenderFns:[]}},function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"list"},[n("ul",e._l(e.sessions,function(t,s){return n("li",{class:[{active:e.currentSession?t.loginName===e.currentSession.loginName:0==s}],on:{click:function(n){e.setCurrentSession(t)}}},[n("img",{staticClass:"avatar",attrs:{width:"30",height:"30",alt:t.loginName,src:t.img}}),e._v(" "),n("p",{staticClass:"name"},[n("span",[e._v(e._s(e._f("truncateStr")(t.loginName)))]),e._v(" "),t.notRead?n("span",{staticStyle:{float:"right","background-color":"red","border-radius":"5px",width:"30px","text-align":"center"}},[e._v("\n          "+e._s(t.notRead)+"\n        ")]):e._e()])])}))])},staticRenderFns:[]}},function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.me?n("div",{staticClass:"view"},[n("div",{staticClass:"sidebar"},[n("card"),e._v(" "),n("list")],1),e._v(" "),n("div",{staticClass:"main"},[n("message"),e._v(" "),n("TextBox")],1),e._v(" "),n("div",{staticClass:"userListPanel"},[n("userListPanel")],1),e._v(" "),n("danmu")],1):n("div",{staticClass:"view"},[n("loginPanel")],1)},staticRenderFns:[]}},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=n(5),i=n.n(s),r=n(48),o=n.n(r),a=n(50),u=n.n(a),c=n(53),l=n.n(c),f=n(52),d=n.n(f),m=n(51),v=n.n(m),g=n(54),p=n.n(g),h=n(49),_=n.n(h),x=(n(10),n(0));t.default={components:{Card:o.a,List:u.a,TextBox:l.a,Message:d.a,loginPanel:v.a,userListPanel:p.a,danmu:_.a},computed:i()({},n.i(x.b)(["me"]))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=n(5),i=n.n(s),r=n(0);t.default={computed:i()({},n.i(r.b)(["me"])),methods:i()({},n.i(r.c)(["setFilterKey"]),{onKeyup:function(e){this.setFilterKey(e.target.value)}})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=(n(44),n(10));t.default={data:function(){return{msg:"",error:""}},methods:{sendBarrage:function(){if(!this.msg)return this.error="弹幕不能为空";this.$store.dispatch("sendBarrage",this.msg),this.msg=this.error=""}},mounted:function(){s.a.state.barrageContainer=document.getElementsByClassName("view")[0]}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=n(5),i=n.n(s),r=n(0);t.default={computed:i()({},n.i(r.b)(["sessions","currentSession"])),methods:i()({},n.i(r.c)(["setCurrentSession"])),filters:{truncateStr:function(e){if(e)return e.substring(0,10)}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=n(5),i=n.n(s),r=n(0),o=n(32);t.default={data:function(){return{showLoginForm:!0,user:{loginName:"",password:"",confirmPassword:"",registerCode:""}}},methods:i()({},n.i(r.d)(["login","register"]),{denglu:function(){return this.user.loginName?this.user.password?void this.login(this.user):void alert("密码不能为空"):void alert("用户名不能为空")},zhuce:function(){return this.user.loginName?this.user.password?this.user.password?this.user.password!==this.user.password?void alert("两次输入密码不一致"):void this.register(this.user):void alert("确认密码不能为空"):void alert("密码不能为空"):void alert("用户名不能为空")},toggleLogin:function(){this.showLoginForm=!this.showLoginForm}}),mounted:function(){var e=n.i(o.e)("credential");e&&(e.autoLogin?this.$store.dispatch("login",e):(this.user.loginName=e.loginName,this.user.password=e.password))}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=n(5),i=n.n(s),r=n(0);t.default={computed:i()({},n.i(r.b)(["me","currentSession"])),filters:{time:function(e){return"string"==typeof e&&(e=new Date(e)),e.getHours()+":"+e.getMinutes()},readFilter:function(e){return e?"已读":"未读"}},directives:{"scroll-bottom":{componentUpdated:function(e){e.scrollTop=e.scrollHeight-e.clientHeight}}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=n(5),i=n.n(s),r=n(0);t.default={computed:i()({},n.i(r.b)(["currentSession"])),data:function(){return{content:""}},methods:{onKeyup:function(e){13===e.keyCode&&this.content.length&&(this.$store.dispatch("sendMsg",this.content),this.content="")}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=n(5),i=n.n(s),r=n(0);t.default={computed:i()({},n.i(r.b)(["onlineUsers"])),methods:i()({},n.i(r.c)(["setCurrentSession"])),filters:{truncateStr:function(e){return e.length>7?e.substring(0,6)+"...":e}}}},function(e,t,n){"use strict";function s(){this.socket.on("register",r),this.socket.on("login",r),this.socket.on("receiveMsg",u),this.socket.on("disconnect",c),this.socket.on("notifyUserLogin",l),this.socket.on("kickOff",f),this.socket.on("receiveRead",a),this.socket.on("receiveBarrage",o)}function i(e){var t=e.host,n=e.port;this.host=t,this.port=n,this.socket=null,this.events=[],this.register=function(e){this.socket.emit("register",e)},this.login=function(e){this.socket.emit("login",e)},this.sendMsg=function(e){this.socket.emit("sendMsg",e)},this.sendBarrage=function(e){this.socket.emit("sendBarrage",e)},this.read=function(e){this.socket.emit("read",e)}}function r(e){var t=e.code,s=e.rMsg,i=e.rData;1===t?(d.a.commit("initUsers",i),d.a.commit("initSessions",i.sessions),n.i(m.e)("credential",i)):alert(s)}function o(e){d.a.commit("appendBarrage",e)}function a(e){var t=d.a.state.currentSession,s=d.a.state.sessions;if(t&&t.loginName===e.to){var i={};return n.i(m.c)(i,t),i.messages.find(function(t){return t.id===e.id}).read=!0,d.a.state.currentSession=i}var r=n.i(m.a)(e.to);if(r){var o={};n.i(m.c)(o,r),o.messages.find(function(t){return t.id===e.id}).read=!0;var a=s.indexOf(r);s.splice(a,1,o)}}function u(e){var t=void 0,s=d.a.state.sessions,i=d.a.state.currentSession,r=d.a.state.users;if(i&&i.loginName===e.from){var o={};return n.i(m.c)(o,i),o.messages.push(e),d.a.state.currentSession=o,d.a.state.client.read(e)}var a=n.i(m.b)(e.from);if((t=n.i(m.a)(e.from))?t.messages.push(e):(t={loginName:e.from,img:a.img,messages:[e]},s.push(t)),!i||i&&i.loginName!==e.from){var u=n.i(m.b)(e.from),c=r.indexOf(u);u.notReadMsgCount||(u.notReadMsgCount=0),u.notReadMsgCount++,r.splice(c,1,u);var l=n.i(m.a)(e.from);c=s.indexOf(l),l.notRead=u.notReadMsgCount,s.splice(c,1,l)}}function c(e){d.a.state.users=d.a.state.users.filter(function(t){return t&&t.loginName!==e})}function l(e){d.a.commit("refreshUser",e)}function f(e){var t=e.rData;d.a.commit("logout"),alert(t)}t.a=i;var d=n(10),m=n(32);i.prototype.on=function(e,t){return this.events[e]=t,this},i.prototype.connect=function(e){if(!("io"in window))return alert("浏览器不支持socket.io"),!1;var t="http://"+this.host+":"+this.port;return this.socket=io.connect(t),s.call(this),!0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=n(33),i=n(45),r=n.n(i),o=n(10),a=n(46),u=(n.n(a),n(47));n.n(u);s.a.config.devtools=!0,new s.a({el:"#app",template:"<App/>",components:{App:r.a},store:o.a})}],[118]);
//# sourceMappingURL=app.305f88daf5ac069bb52d.js.map
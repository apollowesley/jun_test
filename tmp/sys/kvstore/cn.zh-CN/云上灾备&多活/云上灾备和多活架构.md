# 云上灾备和多活架构 {#concept_qf1_mdk_zdb .concept}

云数据库Redis版正式推出Redis实例间的双向同步产品，助力企业快速复制阿里巴巴异地多活架构。

## 架构 { .section}

![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/14010/15330329744934_zh-CN.png)

**架构说明**

-   oplog\(operations log\)：Redis修改数据的写命令记录。

-   ReplicaA、ReplicaB：分别是独立的Redis实例，之间相互同步oplog。

-   ReplicaA、ReplicaB：节点类型是必须双副本及以上，单副本不支持此项功能。


**同步正确性保证**

-   oplog按产生顺序同步到对端。

-   回环控制，解决双向同步的循环同步问题。

-   在对端Redis实例上，所有oplog被执行且仅被执行1次。


**同步可靠性保证**

-   支持断点续传。

    同步中断时间可以达到天级别，与写入速度相关。

-   同步延迟在毫秒级别。

    实测样例：key-value 800Byte，华东2\(上海\)、华北2\(北京\)的同步延迟在100ms~300ms之间。


**限制说明**

-   用户选择1个Redis实例作为ReplicaA，ReplicaB通过clone创建出来，ReplicaA的全量数据自动同步到ReplicaB。

-   不支持在2个已有Redis实例之间直接搭通道。

    不支持直接搭建通道是为了避免2个Redis实例全量数据可能存在数据冲突的问题。

-   当前只支持双活功能\(2个Redis实例之间同步数据\)，后续会上线多活功能\(多个Redis实例之间同步数据\)。


**实例配置要求**

-   引擎版本，支持`Redis 4.0`和`Redis 2.8`。
-   存储类型，只支持`高性能内存型`，`混合存储型`后续会支持。
-   架构类型，只支持`标准版`和`集群版`，`读写分离版`近期会支持。
-   节点类型，只支持`双副本`，`单副本`不会支持。

![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/14010/15330329748300_zh-CN.jpg)

**变更配置**

同步中的实例变更配置说明：

-   `标准版`与`标准版`同步中的云上灾备实例
    -   `标准版`可以变配到其他规格大小的`标准版`。
    -   `标准版`不允许变配到`集群版`，近期会支持。
    -   变配过程中，有50秒左右的同步中断。

-   `集群版`与`集群版`同步中的云上灾备实例
    -   `集群版`不允许变配到其他规格大小的`集群版`，近期会支持。
    -   `集群版`不允许变配到`主从版`，近期会支持。

目前若需要`集群版`相关的变配，需要通过新建云上灾备实例、迁移数据的方式来实现，提工单让工程师协助完成。

**支持云上灾备产品的地域**

以下地域之间均可相互同步数据，可以跨越国家，例如`上海`与`新加坡`。

-   中国大陆

    |地域名称|所在城市|Region ID|
    |----|----|---------|
    |华北 1|青岛|cn-qingdao|
    |华北 2|北京|cn-beijing|
    |华东 1|杭州|cn-hangzhou|
    |华东 2|上海|cn-shanghai|
    |华南 1|深圳|cn-shenzhen|

-   其他国家和地区

    |地域名称|所在城市|Region ID|
    |----|----|---------|
    |香港|香港|cn-hongkong|
    |亚太东南 1|新加坡|ap-southeast-1|
    |美国西部 1|硅谷|us-west-1|
    |美国东部 1|弗吉尼亚|us-east-1|


## 后续新功能 { .section}

-   多活-同步拓扑中的Redis实例个数不限制（当前限制2个）。

-   引入CRDT机制，对于string、counter、hash、set类型，在两端同时操作同一个key，也可以保证value最终一致。



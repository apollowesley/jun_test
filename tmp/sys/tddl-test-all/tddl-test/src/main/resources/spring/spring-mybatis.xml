<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:p="http://www.springframework.org/schema/p"
	   xmlns:context="http://www.springframework.org/schema/context"
	   xmlns:aop="http://www.springframework.org/schema/aop" xmlns:tx="http://www.springframework.org/schema/tx"
	   xmlns:util="http://www.springframework.org/schema/util"
	   xsi:schemaLocation="http://www.springframework.org/schema/beans
    http://www.springframework.org/schema/beans/spring-beans-3.2.xsd
    http://www.springframework.org/schema/context
    http://www.springframework.org/schema/context/spring-context-3.2.xsd
    http://www.springframework.org/schema/tx
    http://www.springframework.org/schema/tx/spring-tx-3.2.xsd
    http://www.springframework.org/schema/aop
    http://www.springframework.org/schema/aop/spring-aop-3.2.xsd
    http://www.springframework.org/schema/util 
    http://www.springframework.org/schema/util/spring-util-3.2.xsd">

	<bean id="dataSource" class="com.taobao.tddl.matrix.jdbc.TDataSource" init-method="init">
		<property name="appName" value="drds"/>
		<property name="ruleFile" value="matrix/mysql_rule.xml"/>
		<property name="topologyFile" value="matrix/server_topology.xml"/>
		<property name="schemaFile" value="matrix/mysql_schema.xml"/>
	</bean>

	<!-- mybatis文件配置，扫描所有mapper文件 -->
	<bean id="sqlSessionFactory" class="org.mybatis.spring.SqlSessionFactoryBean"
		  p:dataSource-ref="dataSource" p:configLocation="classpath:mybatis/mybatis-config.xml"
		  p:mapperLocations="classpath:mybatis/mapper/*.xml" />

	<!-- spring与mybatis整合配置，扫描所有dao -->
	<bean class="org.mybatis.spring.mapper.MapperScannerConfigurer"
		  p:basePackage="com.course.dao" p:sqlSessionFactoryBeanName="sqlSessionFactory" />

	<!-- 对数据源进行事务管理 -->
	<bean id="transactionManager"
		  class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
		<property name="dataSource" ref="dataSource" />
	</bean>


	<bean id="transactionTemplate"
		  class="org.springframework.transaction.support.TransactionTemplate">
		<!-- 事务隔离界别2(READ_COMMITED)，保证事务能够读取到最新的已提交的状态 -->
		<property name="isolationLevel" value="4"></property>
		<!-- 事务超时时间30秒 -->
		<property name="timeout" value="30"/>
		<property name="transactionManager" ref="transactionManager"/>
	</bean>

	<import resource="spring-tddl-sequence.xml" />
</beans>
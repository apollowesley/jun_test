# Kickstart file automatically generated by anaconda.

install
text
cdrom

lang zh_CN.UTF-8
keyboard us

# Skip the X Configuration
skipx

network --bootproto=static --ip 192.168.1.91 --netmask 255.255.255.0 --nameserver 8.8.8.8 --onboot=yes --hostname=hdmail.haodou.com --noipv6
rootpw --iscrypted $1$fNvcciaw$acmhMteupSzC.kjNmFYvx.

authconfig --enableshadow --enablemd5
selinux --disabled
timezone --utc Asia/Shanghai

bootloader --location=mbr
zerombr yes

clearpart --all --initlabel

part /boot --fstype ext3 --size=100 --asprimary
part / --fstype ext3 --size=8000 --grow --maxsize=30000
part /data --fstype ext3 --size=3000 --grow
part swap --size=752  --grow --maxsize=4000

firstboot --disabled

#### reboot the host after installation is done ####
reboot --eject

%packages
@chinese-support
@core
vixie-cron
crontabs
postfix
sudo
wget
vim-enhanced
make
kernel-devel
kernel-headers
gcc
gcc-c++
iptables
ntp

#
# ------- Begin cp pre etc files ---------
#
%post --nochroot
# Mount CDROM
mkdir -p /mnt/cdrom
mount -r -t iso9660 /tmp/cdrom /mnt/cdrom
cp -f /mnt/cdrom/myetc/iptables /mnt/sysimage/etc/sysconfig/iptables >/dev/null
cp -f /mnt/cdrom/myetc/bcp /mnt/sysimage/usr/bin/bcp >/dev/null
cp -f /mnt/cdrom/myetc/ext4.modules /mnt/sysimage/etc/sysconfig/modules/ext4.modules >/dev/null
umount /mnt/cdrom

%post
#vim syntax on
sed -i "8 s/^/alias vi='vim'/" /root/.bashrc 2>/dev/null

echo "
set nocp
set number
set ai
set si
set tabstop=4
set sw=4
set ruler
set incsearch
set showmatch
set matchtime=5
syntax on
" >> /etc/vimrc 2>/dev/null

useradd yongfu
echo abcdyongfu |passwd --stdin yongfu > /dev/null

cat > /etc/sudoers << SUDO
## Sudoers allows particular users to run various commands as
## the root user, without needing the root password.
#
Defaults    requiretty
#
Defaults   !visiblepw
#
Defaults    env_reset
Defaults    env_keep = "COLORS DISPLAY HOSTNAME HISTSIZE INPUTRC KDEDIR \
                        LS_COLORS MAIL PS1 PS2 QTDIR USERNAME \
                        LANG LC_ADDRESS LC_CTYPE LC_COLLATE LC_IDENTIFICATION \
                        LC_MEASUREMENT LC_MESSAGES LC_MONETARY LC_NAME LC_NUMERIC \
                        LC_PAPER LC_TELEPHONE LC_TIME LC_ALL LANGUAGE LINGUAS \
                        _XKB_CHARSET XAUTHORITY"
#
root    ALL=(ALL)   ALL
yongfu    ALL=(ALL)   NOPASSWD: ALL
SUDO

#init_ssh
ssh_cf="/etc/ssh/sshd_config"
sed -i -e '74 s/^/#/' -i -e '76 s/^/#/' $ssh_cf
sed -i "s/#UseDNS yes/UseDNS no/" $ssh_cf
sed -i "s/#PermitRootLogin yes/PermitRootLogin no/" $ssh_cf

# file descriptors
ulimit -HSn 65535
echo -ne "
* soft nofile 65535
* hard nofile 65536
" >>/etc/security/limits.conf

# default useradd
###  mysql ###
groupadd mysql -g 27
useradd -g mysql mysql -u 27  -s /bin/false 

### nginx (www) ###
groupadd  www -g 600  
useradd -g  www www  -u 600  -s /bin/nologin 

### basic dirs ###
### mysql ###
mkdir -p /data/mysql 
mkdir -p /data/logs/mysql/tmp 
chown -R mysql:mysql /data/mysql  
chown -R mysql:mysql  /data/logs/mysql
chmod 777 /data/logs/mysql/tmp

### nginx ###
mkdir -p /data/www/haodou
chown -R www:www /data/www

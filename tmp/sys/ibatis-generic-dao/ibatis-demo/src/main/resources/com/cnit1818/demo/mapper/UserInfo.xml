<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="UserInfo">
    <typeAlias alias="UserInfo" type="com.cnit1818.demo.entity.UserInfo"/>

    <sql id="qrySelect">
        select id id,
			username username,
			opt_time optTime,
			password password
    </sql>

    <select id="selectById" resultClass="UserInfo">
        <include refid="qrySelect"/>
        from user_info
        where
        id=#id#
    </select>

    <insert id="insert">
        insert into user_info (
            	id,
			username,
			opt_time,
			password
            ) values (
        	#id#,
			#username#,
			#optTime#,
			#password#
        )
        <selectKey resultClass="Long" keyProperty="id">
            select LAST_INSERT_ID() AS keykey
        </selectKey>
    </insert>

    <update id="updateById">
        update user_info
        <dynamic prepend="set">
            <isNotNull prepend="," property="username">
                username=#username#
            </isNotNull>
            <isNotNull prepend="," property="optTime">
                opt_time=#optTime#
            </isNotNull>
            <isNotNull prepend="," property="password">
                password=#password#
            </isNotNull>
        </dynamic>
        where id=#id#
    </update>

    <delete id="deleteById">
        delete from user_info where id=#id#
    </delete>


    <sql id="dynamicWhere">
        <dynamic prepend="where">
            <isPropertyAvailable property="id">
                <isNotEmpty prepend="and" property="id">
                    id=#id#
                </isNotEmpty>
            </isPropertyAvailable>
            <isPropertyAvailable property="username">
                <isNotEmpty prepend="and" property="username">
                    username=#username#
                </isNotEmpty>
            </isPropertyAvailable>
            <isPropertyAvailable property="password">
                <isNotEmpty prepend="and" property="password">
                    password=#password#
                </isNotEmpty>
            </isPropertyAvailable>
        </dynamic>
    </sql>

    <sql id="dynamicOrderBy">
        <isPropertyAvailable property="orderBy">
            <isNotEmpty prepend=" order by " property="orderBy">
                $orderBy$
            </isNotEmpty>
        </isPropertyAvailable>
    </sql>

    <select id="selectByCond" resultClass="UserInfo">
        <include refid="qrySelect"/>
        from user_info
        <include refid="dynamicWhere"/>
        <include refid="dynamicOrderBy"/>
    </select>

    <select id="selectCountByCond" resultClass="Integer">
        select count(1) as kk
        from user_info
        <include refid="dynamicWhere"/>
    </select>

</sqlMap>
